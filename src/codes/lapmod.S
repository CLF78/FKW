# Lap Counter
.if (REGION == 'P')
	.set RACEDATA, 0x809BD728
	.set RACEINFO, 0x809BD730
.elseif (REGION == 'U')
	.set RACEDATA, 0x809B8F68
	.set RACEINFO, 0x809B8F70
.elseif (REGION == 'J')
	.set RACEDATA, 0x809BC788
	.set RACEINFO, 0x809BC790
.elseif (REGION == 'K')
	.set RACEDATA, 0x809ABD68
    .set RACEINFO, 0x809ABD70
.else
    .err
.endif

# Free registers: r26, r28
# Target = r28

# Get racedata
lis r26, RACEDATA@ha
lwz r26, RACEDATA@l(r26)

# Load HUD pid and convert it to player array index
# racedata.main = 0x1c
# main.scenarios[0] = 0x4
# scenarios[0].settings = 0xb48
# settings.hudPlayerIds[0] = 0x1c
# total = 0xb84
lbz r26, 0xb84(r26)
rlwinm r26, r26, 2, 0, 29 # multiply by 4

# Get raceinfo pointer - needs special porting
lis r28, RACEINFO@ha
lwz r28, RACEINFO@l(r28)

# Get player from player array
lwz r28, 0xC (r28)
lwzx r28, r28, r26

# Get current lap of player
lbz r28, 0x25 (r28)

# Add 43 to match
extsb r28, r28
addi r28, r28, 43

#ENDCODE

#INJECT 805340A8, 8052F560, 80533A28, 80522100
# Starting Lap Modifier
li r12, -43
sth r12, 0x24(r3)

# Custom Laps Code
#ENDCODE

#SETTYPE COMPILED
#SETREGION P
C25328B0 00000002
38000007 98040B8D
60000000 00000000
C2723D50 00000007
4800002D 00000000
00000000 00000000
3F800000 40000000
40400000 40800000
40A00000 40C00000
40E00000 7CA802A6
38800003 00000000
045336B8 60000000
04534350 60000000
04534BBC 60000000
04723D10 281D0009
04723D40 3BA00009
#ENDCODE

#SETREGION U
C252DD68 00000002
38000007 98040B8D
60000000 00000000
C271F920 00000007
4800002D 00000000
00000000 00000000
3F800000 40000000
40400000 40800000
40A00000 40C00000
40E00000 7CA802A6
38800003 00000000
0452EB70 60000000
0452F808 60000000
04530074 60000000
0471F8E0 281D0009
0471F910 3BA00009
#ENDCODE

#SETREGION J
C2532230 00000002
38000007 98040B8D
60000000 00000000
C27233BC 00000007
4800002D 00000000
00000000 00000000
3F800000 40000000
40400000 40800000
40A00000 40C00000
40E00000 7CA802A6
38800003 00000000
04533038 60000000
04533CD0 60000000
0453453C 60000000
0472337C 281D0009
047233AC 3BA00009
#ENDCODE

#SETREGION K
C2520908 00000002
38000007 98040B8D
60000000 00000000
C27120F8 00000007
4800002D 00000000
00000000 00000000
3F800000 40000000
40400000 40800000
40A00000 40C00000
40E00000 7CA802A6
38800003 00000000
04521710 60000000
045223A8 60000000
04522C14 60000000
047120B8 281D0009
047120E8 3BA00009
#ENDCODE
